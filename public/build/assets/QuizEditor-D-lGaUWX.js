import{r as c,j as e}from"./app-DsiinyfJ.js";import{a as $,H as F,C as T,E as z,L as A}from"./index-DFVleI9N.js";function P({courseId:h,sectionId:u,quiz:i,onClose:p,onSave:v}){const[n,d]=c.useState({title:"",description:"",time_limit:30,passing_score:70}),[o,m]=c.useState([{question:"",options:["","","",""],correct_answer:0,explanation:""}]),[f,b]=c.useState(!1),[l,x]=c.useState({}),[j,y]=c.useState(1);c.useEffect(()=>{i?(d({title:i.title||"",description:i.description||"",time_limit:i.time_limit||30,passing_score:i.passing_score||70}),y(i.quiz_number),i.questions&&i.questions.length>0&&m(i.questions.map(s=>({question:s.question,options:s.options,correct_answer:s.correct_answer,explanation:s.explanation||""})))):_()},[i,u]);const _=async()=>{try{const r=await(await fetch(`/teacher/courses/${h}/sections/${u}/next-quiz-number`)).json();r.success&&y(r.next_number)}catch(s){console.error("Error fetching quiz number:",s)}},Q=()=>{m([...o,{question:"",options:["","","",""],correct_answer:0,explanation:""}])},C=s=>{o.length>1&&m(o.filter((r,t)=>t!==s))},g=(s,r,t)=>{const a=[...o];a[s][r]=t,m(a)},k=(s,r,t)=>{const a=[...o];a[s].options[r]=t,m(a)},S=async s=>{s.preventDefault(),b(!0),x({});const r=o.filter(t=>t.question.trim()&&t.options.every(a=>a.trim())&&t.correct_answer>=0&&t.correct_answer<=3);if(r.length===0){x({questions:["At least one complete question is required"]}),b(!1);return}try{const t={...n,questions:r},a=i?`/teacher/courses/${h}/sections/${u}/quizzes/${i.id}`:`/teacher/courses/${h}/sections/${u}/quizzes`,w=await(await fetch(a,{method:i?"PUT":"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(t)})).json();w.success?v():x(w.errors||{})}catch(t){console.error("Error saving quiz:",t),x({general:"An error occurred while saving the quiz."})}finally{b(!1)}},E=n.title?`Quiz ${j}: ${n.title}`:`Quiz ${j}: [Enter title]`;return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-5 mx-auto p-5 border max-w-4xl shadow-lg rounded-md bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:i?"Edit Quiz":"Add New Quiz"}),e.jsx("button",{onClick:p,className:"text-gray-400 hover:text-gray-600",children:e.jsx($,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"mb-4 p-3 bg-purple-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-purple-700 font-medium flex items-center",children:[e.jsx(F,{className:"mr-2"}),E]})}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Quiz Title *"}),e.jsx("input",{type:"text",id:"title",value:n.title,onChange:s=>d({...n,title:s.target.value}),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter quiz title",required:!0}),l.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.title[0]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"time_limit",className:"block text-sm font-medium text-gray-700",children:"Time Limit (minutes)"}),e.jsx("input",{type:"number",id:"time_limit",value:n.time_limit,onChange:s=>d({...n,time_limit:parseInt(s.target.value)||30}),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",min:"1",max:"180"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{id:"description",rows:3,value:n.description,onChange:s=>d({...n,description:s.target.value}),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Describe what this quiz covers..."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"passing_score",className:"block text-sm font-medium text-gray-700",children:"Passing Score (%)"}),e.jsx("input",{type:"number",id:"passing_score",value:n.passing_score,onChange:s=>d({...n,passing_score:parseInt(s.target.value)||70}),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",min:"1",max:"100",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Questions"}),e.jsxs("button",{type:"button",onClick:Q,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(T,{className:"h-3 w-3 mr-2"}),"Add Question"]})]}),e.jsx("div",{className:"space-y-6",children:o.map((s,r)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h5",{className:"font-medium text-gray-900",children:["Question ",r+1]}),o.length>1&&e.jsx("button",{type:"button",onClick:()=>C(r),className:"text-red-500 hover:text-red-700",children:e.jsx(z,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Question Text *"}),e.jsx("textarea",{rows:2,value:s.question,onChange:t=>g(r,"question",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your question here...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Answer Options *"}),e.jsx("div",{className:"space-y-2",children:s.options.map((t,a)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",name:`correct_answer_${r}`,checked:s.correct_answer===a,onChange:()=>g(r,"correct_answer",a),className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700 w-6",children:[String.fromCharCode(65+a),"."]}),e.jsx("input",{type:"text",value:t,onChange:N=>k(r,a,N.target.value),className:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:`Option ${String.fromCharCode(65+a)}`,required:!0})]},a))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select the radio button next to the correct answer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Explanation (optional)"}),e.jsx("textarea",{rows:2,value:s.explanation,onChange:t=>g(r,"explanation",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Explain why this is the correct answer..."})]})]})]},r))}),l.questions&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:l.questions[0]})]}),l.general&&e.jsx("div",{className:"text-red-600 text-sm",children:l.general}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:p,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:f,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),f?"Saving...":"Save Quiz"]})]})]})]})})}export{P as default};
