import{r as n,j as e}from"./app-DsiinyfJ.js";import{a as k,K as F,G as v,L}from"./index-DFVleI9N.js";function V({courseId:d,sectionId:o,lecture:s,onClose:x,onSave:j}){const[r,c]=n.useState({title:"",content:"",is_preview:!1}),[i,y]=n.useState(null),[u,h]=n.useState(!1),[l,m]=n.useState({}),p=n.useRef(null),[b,f]=n.useState(1);n.useEffect(()=>{s?(c({title:s.title||"",content:s.content||"",is_preview:s.is_preview||!1}),f(s.lecture_number)):N()},[s,o]);const N=async()=>{try{const a=await(await fetch(`/teacher/courses/${d}/sections/${o}/next-lecture-number`)).json();a.success&&f(a.next_number)}catch(t){console.error("Error fetching lecture number:",t)}},w=async t=>{t.preventDefault(),h(!0),m({});try{const a=new FormData;a.append("title",r.title),a.append("content",r.content),a.append("is_preview",r.is_preview?"1":"0"),i&&a.append("video_file",i);const _=s?`/teacher/courses/${d}/sections/${o}/lectures/${s.id}`:`/teacher/courses/${d}/sections/${o}/lectures`,g=await(await fetch(_,{method:s?"PUT":"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:a})).json();g.success?j():m(g.errors||{})}catch(a){console.error("Error saving lecture:",a),m({general:"An error occurred while saving the lecture."})}finally{h(!1)}},S=r.title?`Lecture ${b}: ${r.title}`:`Lecture ${b}: [Enter title]`;return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-10 mx-auto p-5 border max-w-2xl shadow-lg rounded-md bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:s?"Edit Lecture":"Add New Lecture"}),e.jsx("button",{onClick:x,className:"text-gray-400 hover:text-gray-600",children:e.jsx(k,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded-md",children:e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:S})}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Lecture Title *"}),e.jsx("input",{type:"text",id:"title",value:r.title,onChange:t=>c({...r,title:t.target.value}),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter lecture title",required:!0}),l.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.title[0]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700",children:"Lecture Content"}),e.jsx("textarea",{id:"content",rows:6,value:r.content,onChange:t=>c({...r,content:t.target.value}),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Add lecture notes, transcript, or additional content here..."}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"This text content will be available to students alongside the video."}),l.content&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.content[0]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Video Upload"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{type:"button",onClick:()=>{var t;return(t=p.current)==null?void 0:t.click()},className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Choose Video"]}),i&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),i.name,e.jsxs("span",{className:"ml-2 text-xs",children:["(",(i.size/1024/1024).toFixed(2)," MB)"]})]}),(s==null?void 0:s.video_path)&&!i&&e.jsxs("div",{className:"flex items-center text-sm text-green-600",children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Video uploaded"]})]}),e.jsx("input",{ref:p,type:"file",accept:"video/*",onChange:t=>y(t.target.files[0]),className:"hidden"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Supported formats: MP4, AVI, MOV, WMV. Maximum size: 2GB"}),l.video_file&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.video_file[0]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"is_preview",type:"checkbox",checked:r.is_preview,onChange:t=>c({...r,is_preview:t.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"is_preview",className:"ml-2 block text-sm text-gray-900",children:"Allow as preview (visible to non-enrolled students)"})]}),l.general&&e.jsx("div",{className:"text-red-600 text-sm",children:l.general}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:u,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),u?"Saving...":"Save Lecture"]})]})]})]})})}export{V as default};
